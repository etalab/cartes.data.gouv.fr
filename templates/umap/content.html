{% extends "base.html" %}

{% load static from staticfiles %}
{% load leaflet_storage_tags compress %}

{% block extra_head %}

  {% compress css %}
    {% leaflet_storage_css %}
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/reset.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/site.css" %}">

    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/container.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/grid.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/header.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/image.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/menu.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/message.css" %}">

    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/input.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/divider.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/segment.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/button.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/list.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/icon.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/sidebar.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "semantic-ui/css/transition.css" %}">
  {% endcompress css %}

  {% compress js %}
    {% leaflet_storage_js %}
    <script src="{% static "jquery-3.0.0.js" %}"></script>
    <script src="{% static "semantic-ui/js/visibility.js" %}"></script>
    <script src="{% static "semantic-ui/js/sidebar.js" %}"></script>
    <script src="{% static "semantic-ui/js/transition.js" %}"></script>
    <script>
    $(document)
    .ready(function() {

      // fix menu when passed
      $('.masthead')
        .visibility({
          once: false,
          onBottomPassed: function() {
            $('.fixed.menu').transition('fade in');
          },
          onBottomPassedReverse: function() {
            $('.fixed.menu').transition('fade out');
          }
        });

      // create sidebar and attach to menu open
      $('.ui.sidebar')
        .sidebar('attach events', '.toc.item');

    });
    </script>
  {% endcompress js %}
{% endblock %}

{% block header %}
  {% block menu %}
    {% include "umap/menu.html" %}
  {% endblock menu %}
{% endblock %}

{% block content %}
{% endblock content %}

{% block bottom_js %}
  {{ block.super }}
  <script type="text/javascript">

    // Dismiss blocks
    $('.message .close')
    .on('click', function() {
      $(this)
        .closest('.message')
        .transition('fade');
    });

    !(function() {
    var ui = new L.S.UI(document.body);
    var xhr = new L.S.Xhr(ui);
    var logins = document.querySelectorAll('a.login');
    for (var i = 0; i < logins.length; i++) {
      L.DomEvent.on(logins[i], 'click', function (e) {
        L.DomEvent.stop(e);
        xhr.login({
            "login_required": this.getAttribute('href'),
            "redirect": "/"
        });
      });
    }
    var logout = document.querySelector('a.logout');
    if (logout) {
      L.DomEvent.on(logout, 'click', function (e) {
        L.DomEvent.stop(e);
        xhr.logout(this.getAttribute('href'));
      });
    }
    var getMore = function (e) {
      L.DomEvent.stop(e);
      xhr._ajax({
        uri: this.href,
        verb: 'GET',
        callback: function (data) {
            var container = this.parentNode;
            container.innerHTML = data;
            Array.prototype.forEach.call(container.querySelectorAll('script'), function (item) {
                eval(item.firstChild.textContent);
            });
            var more = document.querySelector('.more_button');
            if (more) {
              L.DomEvent.on(more, 'click', getMore, more);
            }
        },
        context: this
      });
    };
    var more = document.querySelector('.more_button');
    if (more) {
      L.DomEvent.on(more, 'click', getMore, more);
    }
    })(this);
  </script>
{% endblock bottom_js %}
